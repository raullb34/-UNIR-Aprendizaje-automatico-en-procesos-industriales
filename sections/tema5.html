<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tema 5: Evaluación de Clasificación</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        .card { @apply bg-white p-6 rounded-xl shadow-md border border-gray-100 hover:shadow-lg transition-shadow; }
        .metric-card { @apply p-4 rounded-lg border text-center transition-all; }
        .matrix-cell { @apply flex flex-col items-center justify-center p-4 rounded-lg border-2 font-bold text-lg; }
        .input-matrix { @apply w-16 text-center border-b-2 border-slate-300 focus:border-indigo-500 outline-none font-mono text-xl; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans leading-relaxed">

    <!-- Navegación -->
    <nav class="bg-white border-b border-slate-200 p-4 shadow-sm">
        <div class="max-w-5xl mx-auto">
            <a href="../index.html" class="text-indigo-600 hover:text-indigo-800 font-medium flex items-center gap-2 w-fit">
                <i class="fas fa-arrow-left"></i> Volver al Hub
            </a>
        </div>
    </nav>

    <!-- Header -->
    <header class="bg-indigo-700 text-white py-12 px-6 shadow-lg">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-4xl font-extrabold mb-2 text-white">Tema 5: Evaluación de Clasificación</h1>
            <p class="text-indigo-100 text-lg">Métricas de rendimiento para modelos que predicen categorías o clases.</p>
        </div>
    </header>

    <main class="max-w-5xl mx-auto p-6 space-y-12">
        
        <!-- Sección 1: La Matriz de Confusión -->
        <section>
            <h2 class="text-2xl font-bold text-slate-700 mb-6 border-b-2 border-indigo-200 pb-2">1. La Matriz de Confusión (Cap. 5.4)</h2>
            <p class="mb-6 text-slate-600">Es la herramienta base para evaluar modelos de clasificación binaria. Divide las predicciones en cuatro categorías críticas:</p>
            
            <div class="grid md:grid-cols-2 gap-8 items-center">
                <div class="grid grid-cols-2 gap-4">
                    <!-- TP -->
                    <div class="matrix-cell bg-emerald-50 border-emerald-200 text-emerald-700">
                        <span class="text-xs uppercase opacity-70">Verdaderos Positivos</span>
                        <input type="number" id="m_tp" value="85" class="input-matrix bg-transparent text-emerald-800" onchange="updateMetrics()">
                        <span class="text-[10px] mt-1 font-normal">(TP)</span>
                    </div>
                    <!-- FN -->
                    <div class="matrix-cell bg-orange-50 border-orange-200 text-orange-700">
                        <span class="text-xs uppercase opacity-70">Falsos Negativos</span>
                        <input type="number" id="m_fn" value="15" class="input-matrix bg-transparent text-orange-800" onchange="updateMetrics()">
                        <span class="text-[10px] mt-1 font-normal text-slate-500">Error Tipo II</span>
                    </div>
                    <!-- FP -->
                    <div class="matrix-cell bg-red-50 border-red-200 text-red-700">
                        <span class="text-xs uppercase opacity-70">Falsos Positivos</span>
                        <input type="number" id="m_fp" value="10" class="input-matrix bg-transparent text-red-800" onchange="updateMetrics()">
                        <span class="text-[10px] mt-1 font-normal text-slate-500">Error Tipo I</span>
                    </div>
                    <!-- TN -->
                    <div class="matrix-cell bg-slate-100 border-slate-300 text-slate-700">
                        <span class="text-xs uppercase opacity-70">Verdaderos Negativos</span>
                        <input type="number" id="m_tn" value="190" class="input-matrix bg-transparent text-slate-800" onchange="updateMetrics()">
                        <span class="text-[10px] mt-1 font-normal">(TN)</span>
                    </div>
                </div>

                <div class="card bg-indigo-50 border-indigo-100">
                    <h3 class="font-bold text-indigo-900 mb-3 text-center">Resumen de Métricas</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center bg-white p-2 rounded shadow-sm">
                            <span class="font-semibold text-sm">Accuracy (Exactitud):</span>
                            <span id="res_acc" class="font-mono font-bold text-indigo-600 text-lg">0.00</span>
                        </div>
                        <div class="flex justify-between items-center bg-white p-2 rounded shadow-sm">
                            <span class="font-semibold text-sm">Precision (Precisión):</span>
                            <span id="res_pre" class="font-mono font-bold text-emerald-600 text-lg">0.00</span>
                        </div>
                        <div class="flex justify-between items-center bg-white p-2 rounded shadow-sm">
                            <span class="font-semibold text-sm">Recall (Sensibilidad):</span>
                            <span id="res_rec" class="font-mono font-bold text-orange-600 text-lg">0.00</span>
                        </div>
                        <div class="flex justify-between items-center bg-white p-2 rounded shadow-sm">
                            <span class="font-semibold text-sm">F1-Score:</span>
                            <span id="res_f1" class="font-mono font-bold text-indigo-500 text-lg">0.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección 2: Definiciones Matemáticas -->
        <section>
            <h2 class="text-2xl font-bold text-slate-700 mb-6">2. Definiciones de Métricas</h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="card">
                    <h4 class="font-bold text-indigo-700 mb-2">Precisión (Precision)</h4>
                    <p class="text-xs text-slate-500 mb-4">¿De todos los que predije como positivos, cuántos eran realmente positivos?</p>
                    <div class="math-block">
                        $$Precision = \frac{TP}{TP + FP}$$
                    </div>
                </div>
                <div class="card">
                    <h4 class="font-bold text-orange-700 mb-2">Sensibilidad (Recall)</h4>
                    <p class="text-xs text-slate-500 mb-4">¿De todos los positivos reales, cuántos logré detectar?</p>
                    <div class="math-block">
                        $$Recall = \frac{TP}{TP + FN}$$
                    </div>
                </div>
                <div class="card md:col-span-2 bg-slate-900 text-white border-none">
                    <h4 class="font-bold text-indigo-400 mb-2">Valor F (F-Measure / F1-Score)</h4>
                    <p class="text-xs text-slate-400 mb-4 text-center">Promedio armónico entre precisión y sensibilidad. Útil cuando hay clases desbalanceadas.</p>
                    <div class="bg-black/30 p-4 rounded text-xl text-center">
                        $$F_1 = 2 \cdot \frac{Precision \cdot Recall}{Precision + Recall}$$
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección 3: Curvas ROC y AUC -->
        <section>
            <div class="flex justify-between items-end mb-6 border-b-2 border-indigo-200 pb-2">
                <h2 class="text-2xl font-bold text-slate-700">3. Curvas ROC y AUC (Cap. 5.5)</h2>
                <span class="px-3 py-1 bg-amber-100 text-amber-700 rounded-full text-xs font-bold uppercase">Análisis de Umbral</span>
            </div>
            
            <div class="grid md:grid-cols-3 gap-8">
                <div class="md:col-span-1 space-y-4">
                    <div class="p-4 bg-white rounded-lg border border-slate-200 shadow-sm">
                        <h5 class="font-bold text-sm mb-2 text-indigo-800">¿Qué es el AUC?</h5>
                        <p class="text-xs text-slate-600 leading-relaxed">
                            Es el "Área bajo la curva". Representa la probabilidad de que el modelo clasifique un ejemplo positivo aleatorio por encima de uno negativo aleatorio.
                        </p>
                        <ul class="mt-4 text-[11px] space-y-2 text-slate-500">
                            <li><strong>AUC = 0.5:</strong> Clasificador aleatorio (moneda al aire).</li>
                            <li><strong>AUC = 1.0:</strong> Clasificador perfecto.</li>
                        </ul>
                    </div>
                    <div class="p-4 bg-indigo-900 text-white rounded-lg shadow-md">
                        <p class="text-[10px] uppercase font-bold text-indigo-300">Eje Y</p>
                        <p class="text-sm">TPR (Tasa Verdadero Positivo)</p>
                        <div class="my-2 border-t border-indigo-700"></div>
                        <p class="text-[10px] uppercase font-bold text-indigo-300">Eje X</p>
                        <p class="text-sm">FPR (Tasa Falso Positivo)</p>
                    </div>
                </div>
                <div class="md:col-span-2 card">
                    <canvas id="rocChart" height="250"></canvas>
                </div>
            </div>
        </section>

        <!-- Sección 4: Código en Scikit-Learn -->
        <section class="bg-slate-900 text-slate-100 p-8 rounded-2xl shadow-xl">
            <h2 class="text-2xl font-bold mb-4">4. Implementación de Evaluación</h2>
            <pre class="bg-black/40 border border-slate-700 p-4 rounded-lg overflow-x-auto font-mono text-sm leading-6"><code>from sklearn.metrics import confusion_matrix, classification_report, roc_auc_score

# 1. Matriz de Confusión
cm = confusion_matrix(y_test, y_pred)

# 2. Reporte completo (Precision, Recall, F1)
report = classification_report(y_test, y_pred)
print(report)

# 3. Cálculo de AUC (requiere probabilidades)
y_probs = model.predict_proba(X_test)[:, 1]
auc = roc_auc_score(y_test, y_probs)
print(f"Área bajo la curva (AUC): {auc:.2f}")</code></pre>
        </section>

    </main>

    <footer class="text-center py-10 text-slate-400 text-sm">
        <p>Material de Apoyo - Tema 5: Evaluación de Clasificación | IA Industrial</p>
    </footer>

    <script>
        function updateMetrics() {
            const tp = parseInt(document.getElementById('m_tp').value) || 0;
            const fn = parseInt(document.getElementById('m_fn').value) || 0;
            const fp = parseInt(document.getElementById('m_fp').value) || 0;
            const tn = parseInt(document.getElementById('m_tn').value) || 0;

            const total = tp + fn + fp + tn;
            
            const acc = total > 0 ? (tp + tn) / total : 0;
            const pre = (tp + fp) > 0 ? tp / (tp + fp) : 0;
            const rec = (tp + fn) > 0 ? tp / (tp + fn) : 0;
            const f1 = (pre + rec) > 0 ? 2 * (pre * rec) / (pre + rec) : 0;

            document.getElementById('res_acc').innerText = acc.toFixed(3);
            document.getElementById('res_pre').innerText = pre.toFixed(3);
            document.getElementById('res_rec').innerText = rec.toFixed(3);
            document.getElementById('res_f1').innerText = f1.toFixed(3);
        }

        // Configuración de la Gráfica ROC
        const ctxRoc = document.getElementById('rocChart').getContext('2d');
        new Chart(ctxRoc, {
            type: 'line',
            data: {
                datasets: [
                    {
                        label: 'Clasificador Actual (AUC=0.88)',
                        data: [
                            {x: 0, y: 0}, {x: 0.05, y: 0.4}, {x: 0.1, y: 0.7}, 
                            {x: 0.2, y: 0.85}, {x: 0.4, y: 0.92}, {x: 0.7, y: 0.97}, {x: 1, y: 1}
                        ],
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        fill: true,
                        tension: 0.3
                    },
                    {
                        label: 'Azar (Referencia)',
                        data: [{x: 0, y: 0}, {x: 1, y: 1}],
                        borderColor: '#94a3b8',
                        borderDash: [5, 5],
                        pointRadius: 0,
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { type: 'linear', min: 0, max: 1, title: { display: true, text: 'Tasa Falsos Positivos (1 - Especificidad)' } },
                    y: { min: 0, max: 1, title: { display: true, text: 'Tasa Verdaderos Positivos (Sensibilidad)' } }
                }
            }
        });

        // Inicializar métricas
        window.onload = updateMetrics;
    </script>
</body>
</html>